storage:
  rootDirectory: /var/lib/registry
  dedupe: true
  gc: true
  gcDelay: 1h
  gcInterval: 24h
  retention:
    dryRun: false
    delay: 24h
    policies:
      - repositories:
          - "**"
        deleteReferrers: true
        deleteUntagged: true
        keepTags:
          - mostRecentlyPushedCount: 3
            mostRecentlyPulledCount: 3
            pulledWithin: 168h  # 7d
            pushedWithin: 168h

http:
  address: "0.0.0.0"
  port: "5000"
  compat:
    - docker2s2

log:
  level: debug
  #output: /var/lib/registry/zot.log
  audit: /var/lib/registry/zot-audit.log

extensions:
  metrics:
    enable: true
    prometheus:
      path: /metrics
  search:
    enable: true
  ui:
    enable: true
  sync:
    # sync disabled because platform specific sync not yet supported
    # https://github.com/project-zot/zot/pull/3128
    # images are mirrored explicitly with regsync
    enable: false
    credentialsFile: /secrets/sync-auth.json
    registries:
      - urls:
          - https://index.docker.io
        content:
          - prefix: "**"
            destination: /docker.io
        onDemand: true
        tlsVerify: true
        preserveDigest: true
      - urls:
          - https://ghcr.io
        content:
          - prefix: "**"
            destination: /ghcr.io
        onDemand: true
        tlsVerify: true
      - urls:
          - https://registry.k8s.io
        content:
          - prefix: "**"
            destination: /registry.k8s.io
        onDemand: true
        tlsVerify: true
      - urls:
          - https://quay.io
        content:
          - prefix: "**"
            destination: /quay.io
        onDemand: true
        tlsVerify: true
